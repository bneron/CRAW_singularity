stages:
  - test
  - release
  
variables:
  CRAW_HOME: ${CI_PROJECT_DIR}
  CRAW_VERSION: ${CI_COMMIT_REF_NAME}

test:
    image: registry-gitlab.pasteur.fr/bneron/craw:centos-dep-0.6
    stage: test
    script:
        - python3 ${CI_PROJECT_DIR}/tests/run_tests.py -vvv
    except:
        - /^feat.*$/
        - /^fix.*$/

release:
  image: registry-gitlab.pasteur.fr/bneron/craw:release-0.6
  script:
    - cd ${CI_PROJECT_DIR}/doc/
    - make html
    - make latexpdf
    - cd ${CI_PROJECT_DIR}
    - python3 sdist
  artifacts:
    name: craw-"$CI_COMMIT_REF_NAME".tar.gz
    paths:
    - dist/craw*.tar.gz
  only:
    - tags
